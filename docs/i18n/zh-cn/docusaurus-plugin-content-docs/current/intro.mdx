---
sidebar_position: 1
title: å¿«é€Ÿå…¥é—¨
---

[//]: # (Copyright Paion Data)

[//]: # (Licensed under the Apache License, Version 2.0 &#40;the "License"&#41;;)
[//]: # (you may not use this file except in compliance with the License.)
[//]: # (You may obtain a copy of the License at)

[//]: # (    http://www.apache.org/licenses/LICENSE-2.0)

[//]: # (Unless required by applicable law or agreed to in writing, software)
[//]: # (distributed under the License is distributed on an "AS IS" BASIS,)
[//]: # (WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.)
[//]: # (See the License for the specific language governing permissions and)
[//]: # (limitations under the License.)

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::caution

å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸æ”¯æŒ Spring/Spring Boot æ¡†æ¶ï¼Œ[Astraios] æ˜¯ä¸€ä¸ªä¸¥æ ¼éµç…§ **[JAX-RS]** æ ‡å‡†è¿è¡Œçš„ web
æœåŠ¡ï¼ŒèƒŒåé‡‡ç”¨å®˜æ–¹æŒ‡å®š [Jersey] æ¡†æ¶å®ç°ï¼Œå¹¶ä»¥ WAR çš„å½¢å¼è¿è¡Œäº [Jetty] å®¹å™¨æœåŠ¡ä¸­ã€‚

äº†è§£æ›´å¤šå…³äº JAX-RS å’Œ Spring åŒºåˆ«ï¼Œè¯·è¯¦é˜…[è¿™ç¯‡å¸–å­](https://stackoverflow.com/a/42955575)

:::

éœ€è¦æ­å»ºä¸€ä¸ª API ï¼Ÿ
----------------

:::info è¯·ç¡®ä¿å·²ç»å®‰è£… JDK 17, Maven, å’Œ Docker Engine ğŸ¤—

- æˆ‘ä»¬æä¾›å¦‚ä½•å®‰è£… JDK 17 å’Œ Maven çš„[æ•™ç¨‹](setup#installing-java--maven-on-mac)
- æˆ‘ä»¬ä¹Ÿæä¾›[å®‰è£… Docker Engine çš„é“¾æ¥](setup#installing-docker-engine)

:::

å°†ä»“åº“æ¨¡ç‰ˆå®ä¾‹åŒ–
--------------

è¯·è®¿é—®[Astraios GitHub]ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š

1. ä½¿ç”¨ `git clone https://github.com/paion-data/astraios.git` å…‹éš†ä»£ç ä»“åº“ï¼Œæˆ–è€…
2. ç”¨æˆ‘ä»¬è‡ªå·±çš„ Web æœåŠ¡åç§°æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥å°†æ¨¡ç‰ˆå®ä¾‹åŒ–ï¼š

  ![Error loading instantiation-1.png](./img/instantiation-1.png)
  ![Error loading instantiation-2.png](./img/instantiation-2.png)

åˆ›å»ºæ•°æ®æ¨¡å‹
----------

Astraios æ¨¡å‹æ˜¯ä¸€ä¸ª Web æœåŠ¡é¡¹ç›®ä¸­æœ€é‡è¦çš„ä»£ç ä¹‹ä¸€ã€‚æ­¤æ¨¡å‹æ˜¯æˆ‘ä»¬å¸Œæœ›å…¬å¼€çš„æ•°æ®è§†å›¾ã€‚
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ _book_ è¿›è¡Œå»ºæ¨¡ï¼Œå› ä¸ºå¤§å¤šæ•°äººå¯¹ç”Ÿæ´»ä¸­çš„ä¹¦æ¯”è¾ƒç†Ÿæ‚‰ã€‚

æˆ‘ä»¬çš„ _Book_ æ¨¡å‹å¤§è‡´å¦‚ä¸‹ï¼š

```java
import com.paiondata.elide.annotation.Include;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import jakarta.persistence.Table;

@Entity
@Table(name = "book")
@Include(rootLevel = true, name = "book", description = "book entity", friendlyName = "book")
public class Book {

    @Id
    @GeneratedValue
    public long id;

    public String title = "";
}
```

:::tip

æ¨¡å‹é€šå¸¸æ‰“åŒ…ä¸ºä¸€ä¸ªå•ç‹¬ Maven é¡¹ç›®ä¸­çš„ **JAR** æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª
å®Œæ•´çš„[ç¤ºä¾‹](https://github.com/paion-data/astraios-data-models-example)

:::

æœ€åï¼Œè¿è¡Œ `mvn clean install` æ¥å®‰è£…æ¨¡å‹

:::info

åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨[è¿™ä¸ªç¤ºä¾‹æ•°æ®æ¨¡å‹][astraios-data-models-example]

```bash
git clone https://github.com/paion-data/astraios-data-models-example.git
cd astraios-data-models-example.git
mvn clean install
```

:::

åŠ è½½æ•°æ®æ¨¡å‹
----------

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€äº›æ¨¡å‹ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰ API çš„è¯å¹¶ä¸æ˜¯å¾ˆæœ‰ç”¨ã€‚
éœ€è¦è®© _my-webservice_ é€šè¿‡ Maven é…ç½®æ–‡ä»¶æ¥
åŠ è½½[æ•°æ®æ¨¡å‹](#creating-models)ï¼Œå³ **~/.m2/settings.xml**ï¼š

```xml
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                      http://maven.apache.org/xsd/settings-1.0.0.xsd">

    <profiles>
        <profile>
            <id>astraios-data-models</id>
            <properties>
                <model.package.jar.group.id>com.paiondata</model.package.jar.group.id>
                <model.package.jar.artifact.id>astraios-data-models-example</model.package.jar.artifact.id>
                <model.package.jar.version>1.0.0</model.package.jar.version>
            </properties>
        </profile>
    </profiles>

    <activeProfiles>
        <activeProfile>astraios-data-models</activeProfile>
    </activeProfiles>
</settings>
```

è¿è¡Œ
----

æœ‰äº†å®šä¹‰çš„æ•°æ®æ¨¡å‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ _my-webservice_

```bash
cd my-webservice
mvn clean package
MODEL_PACKAGE_NAME=com.paiondata.astraios.data.models docker compose up --build --force-recreate
```

:::info

`com.paiondata.astraios.data.models` æ˜¯ä¹‹å‰æåˆ°çš„[æ•°æ®æ¨¡å‹åŒ…][astraios-data-models-example]åç§°

:::

å†™å…¥æ•°æ®
--------

### æ’å…¥æ•°æ®

æˆ‘ä»¬å·²ç»å®šä¹‰äº†æ•°æ®åº“è§†å›¾å¹¶é€šè¿‡ HTTP å…¬å¼€äº†è¿™äº›è§†å›¾ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨ cURL å°†æ•°æ®æ”¾å…¥æ•°æ®åº“ã€‚

<Tabs>
  <TabItem value="jsonapi" label="JSON-API" default>
    ```bash
    curl -X POST http://localhost:8080/v1/data/book \
        -H "Content-Type: application/vnd.api+json" \
        -H "Accept: application/vnd.api+json" \
        -d '{"data": {"type": "book", "attributes": { "title": "Pride and Prejudice" }}}'
    ```
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    ```bash
    curl -X POST "http://localhost:8080/v1/data" \
        -H "Content-Type: application/json" \
        -H "Accept: application/json"  \
        -d '{ "query" : "mutation { book(op: UPSERT, data:{title: \"Pride & Prejudice\"}) { edges { node { id title } } } }" }'
    ```
  </TabItem>
  <TabItem value="graphql-query" label="(GraphQL) Query">
    ```graphql
    mutation {
      book(op: UPSERT, data:{title: "Pride & Prejudice"}) {
        edges {
          node {
            id
            title
          }
        }
      }
    }
    ```
  </TabItem>
</Tabs>

å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ª cURL è°ƒç”¨æ—¶ï¼Œåº”è¯¥ä¼šçœ‹åˆ°è¿”å›å¾ˆå¤š JSONï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ–°åˆ›å»ºçš„æ•°æ®å¯¹è±¡ï¼

<Tabs>
  <TabItem value="jsonapi" label="JSON-API" default>
    ```json
    {
       "data":{
          "type":"book",
          "id":"1",
          "attributes":{
             "title":"Pride and Prejudice"
          }
       }
    }
    ```
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    ```json
    {
       "data":{
          "book":{
             "edges":[
                {
                   "node":{
                      "id":"4",
                      "title":"Pride & Prejudice"
                   }
                }
             ]
          }
       }
    }
    ```
  </TabItem>
</Tabs>

### æŸ¥çœ‹æˆ‘ä»¬çš„æ•°æ®

<Tabs>
  <TabItem value="browser" label="Web Browser" default>
    <!-- markdown-link-check-disable -->
    åªéœ€æ‰“å¼€ä»»æ„æµè§ˆå™¨å¹¶è®¿é—® **http://localhost:8080/v1/data/book**
    <!-- markdown-link-check-enable -->

:::tip

å»ºè®®ä½¿ç”¨ä¸€äº›[JSONæ ¼å¼åŒ–](https://chromewebstore.google.com/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa)æµè§ˆå™¨
æ‰©å±•æ¥æŸ¥çœ‹ç»“æœï¼Œæ•°æ®å†…å®¹æ›´åŠ æ˜“è¯»

:::

  </TabItem>
  <TabItem value="json-api" label="JSON-API">
    ```bash
    curl "http://localhost:8080/v1/data/book"
    ```
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    ```bash
    curl -X POST "http://localhost:8080/v1/data" \
        -H "Content-Type: application/json" \
        -H "Accept: application/json"  \
        -d '{ "query" : "{ book { edges { node { id title } } } }" }'
    ```
  </TabItem>
  <TabItem value="graphql-query" label="(GraphQL) Query">
    ```graphql
    {
      book {
        edges {
          node {
            id
            title
          }
        }
      }
    }
    ```
  </TabItem>
</Tabs>

### æ›´æ–°æ•°æ®

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åˆ›å»ºå®ƒæ—¶å¹¶æ²¡æœ‰è®¾ç½®æ–°ä¹¦è®°å½•çš„ä»»ä½•å±æ€§ã€‚ç”¨æˆ·æ›´æ–°æ•°æ®å’Œæ·»åŠ æ–°æ•°æ®ä¸€æ ·ç®€å•ã€‚
ä½¿ç”¨ä»¥ä¸‹ cURL è°ƒç”¨æ›´æ–°æˆ‘ä»¬çš„æ•°æ®ã€‚

<Tabs>
  <TabItem value="jsonapi" label="JSON-API" default>
    ```bash
    curl -X PATCH http://localhost:8080/v1/data/book/1 \
        -H "Content-Type: application/vnd.api+json" \
        -H "Accept: application/vnd.api+json" \
        -d '{"data": {"type": "book", "id": "1", "attributes": { "title": "Emma" }}}'
    ```
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    ```bash
    curl -X POST "http://localhost:8080/v1/data" \
        -H "Content-Type: application/json" \
        -H "Accept: application/json"  \
        -d '{ "query" : "mutation { book(op: UPSERT, data: {id: \"1\", title: \"Emma\"}) { edges { node { id title } } } }" }'
    ```
  </TabItem>
  <TabItem value="graphql-query" label="(GraphQL) Query">
    ```graphql
    mutation {
      book(op: UPSERT, data: {id: "1", title: "Emma"}) {
        edges {
          node {
            id
            title
          }
        }
      }
    }
    ```
  </TabItem>
</Tabs>

[Astraios]: https://astraios.io/
[Astraios GitHub]: https://github.com/paion-data/astraios

[JAX-RS]: https://jcp.org/en/jsr/detail?id=370
[Jersey]: https://eclipse-ee4j.github.io/jersey.github.io/documentation/latest/index.html
[astraios-data-models-example]: https://github.com/paion-data/astraios-data-models-example
[Jetty]: https://eclipse.dev/jetty/
